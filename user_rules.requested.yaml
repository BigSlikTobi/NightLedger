policy_set: nightledger-v1
currency: USD

global_goal:
  objective: "maximize_company_outcome"
  weights:
    cost: 0.45
    performance: 0.25
    reliability_sla: 0.30

rules:
  - id: budget_monthly_cap
    type: guardrail
    when: "projected_monthly_spend > 50000"
    action: "require_approval"
    reason: "Monthly budget cap exceeded"

  - id: request_cost_cap
    type: guardrail
    when: "estimated_total_cost > 3000"
    action: "require_approval"
    reason: "Per-request cost above cap"

  - id: min_reliability_floor
    type: hard_constraint
    when: "offer.reliability < 0.90"
    action: "reject_offer"
    reason: "Reliability below SLA floor"

  - id: urgency_bias
    type: scoring_override
    when: "request.priority in ['high','urgent','critical']"
    set_weights:
      cost: 0.30
      performance: 0.30
      reliability_sla: 0.40
    reason: "Urgent requests prioritize SLA/perf"

  - id: provider_concentration_limit
    type: portfolio_constraint
    when: "provider_share_rolling_30d > 0.60"
    action: "require_approval_or_next_best"
    reason: "Provider concentration risk too high"

  - id: approved_regions_only
    type: hard_constraint
    when: "offer.region not_in ['EU','us-east-1','us-west-2']"
    action: "reject_offer"
    reason: "Region not approved"

  - id: fallback_required
    type: hard_constraint
    when: "fallback_candidates_count < 1"
    action: "require_approval"
    reason: "No fallback option available"

  - id: price_anomaly_up
    type: anomaly
    when: "offer.estimated_total_cost > (rolling_median_cost_gpu_class * 1.35)"
    action: "require_approval"
    reason: "Cost anomaly above expected range"

  - id: strategy_underperforms_aws
    type: benchmark_fail_safe
    when: "objective_score_rolling_100 < aws_baseline_objective_rolling_100 * 0.97"
    action: "switch_mode_conservative"
    reason: "Strategy underperforming AWS baseline"

  - id: new_provider_gate
    type: approval_gate
    when: "offer.provider not_in approved_providers"
    action: "require_approval"
    reason: "First-time provider usage"

approvals:
  conservative_mode:
    defaults:
      allowed_providers: ["aws", "gcp", "azure", "lambda", "runpod"]
      min_reliability: 0.93
      max_request_cost: 2000

audit:
  log_decision_text: true
  log_validation: true
  log_benchmark_comparison: true
  append_only: true
